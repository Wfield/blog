## Part I

**名称**

http + SSL/TLS 等于 https

TLS 是 SSL 的升级版



**背景**

http 通行的三大风险：

> （1） **窃听风险**（eavesdropping）：第三方可以获知通信内容。
>
> > 客户端和服务器直接的通信只有自己能看懂，即使第三方拿到数据也看不懂这些信息的真实含义。
>
> （2） **篡改风险**（tampering）：第三方可以修改通信内容。
>
> > 第三方虽然看不懂数据，但可以 XJB 改，因此客户端和服务器必须有能力判断数据是否被修改过。
>
> （3） **冒充风险**（pretending）：第三方可以冒充他人身份参与通信。
>
> > 客户端必须避免中间人攻击，即除了真正的服务器，任何第三方都无法冒充服务器。

SSL/TLS协议是为了解决这三大风险而设计的，希望达到：

> （1） 所有信息都是**加密传播**，第三方无法窃听。
>
> （2） 具有**校验机制**，一旦被篡改，通信双方会立刻发现。
>
> （3） 配备**身份证书**，防止身份被冒充。



**非对称加密**

非对称加密有两个秘钥，一个是公钥，一个是私钥。公钥加密的内容只有私钥可以解密，私钥加密的内容只有公钥可以解密。



## Part II

1. **客户端**想服务器请求公钥

   > 客户端（通常是浏览器）先向服务器发出加密通信的请求，这被叫做ClientHello请求
   >
   > 在这一步，客户端主要向服务器提供以下信息。
   >
   > （1） 支持的协议版本，比如TLS 1.0版。
   >
   > （2） 一个客户端生成的**随机数**，稍后用于生成"对话密钥"。
   >
   > （3） 支持的加密方法，比如RSA公钥加密。
   >
   > （4） 支持的压缩方法。

2. **服务器**返回数字证书

   > 服务器收到客户端请求后，向客户端发出回应，这叫做SeverHello。服务器的回应包含以下内容。
   >
   > （1） 确认使用的加密通信协议版本，比如TLS 1.0版本。如果浏览器与服务器支持的版本不一致，服务器关闭加密通信。
   >
   > （2） 一个服务器生成的**随机数**，稍后用于生成"对话密钥"。
   >
   > （3） 确认使用的加密方法，比如RSA公钥加密。
   >
   > （4） 服务器证书。

3. **客户端**对数字证书进行验证，得到公钥

   > 浏览器安装后会自带一些权威机构的公钥，使用匹配的公钥对数字签名进行解密，根据签名生成规则对网站信息进行本地签名生成。两个签名对比成功，则说明拿到的服务器公钥是正确的

4. **客户端**生成随机对称密钥

5. **客户端**使用服务器公钥对对称密钥进行加密

6. **客服端**发送给服务器加密后的对称密钥，**并表示客户端握手阶段结束**

   > 如果证书没有问题，客户端就会从证书中取出服务器的公钥。然后，向服务器发送下面三项信息。
   >
   > （1） 一个**随机数**。该随机数用服务器公钥加密，防止被窃听。
   >
   > （2） 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。
   >
   > （3） 客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验。

7. **服务器**收到客户端的第三个随机数pre-master key之后，计算生成本次会话所用的"会话密钥"。然后，向客户端最后发送下面信息。**表示服务器的握手阶段已经结束**

   > （1）编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。
   >
   > （2）服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供客户端校验。

8. **整个握手阶段全部结束，客户端与服务器进入加密通信，就完全是使用普通的HTTP协议，只不过用"会话密钥"加密内容**



> ###会话密钥的生成
>
> "不管是客户端还是服务器，都需要随机数，这样生成的密钥才不会每次都一样。由于SSL协议中证书是静态的，因此十分有必要引入一种随机因素来保证协商出来的密钥的随机性。
>
> 对于RSA密钥交换算法来说，pre-master-key本身就是一个随机数，再加上hello消息中的随机，三个随机数通过一个密钥导出器最终导出一个对称密钥。
>
> pre master的存在在于SSL协议不信任每个主机都能产生完全随机的随机数，如果随机数不随机，那么pre master secret就有可能被猜出来，那么仅适用pre master secret作为密钥就不合适了，因此必须引入新的随机因素，那么客户端和服务器加上pre master secret三个随机数一同生成的密钥就不容易被猜出了，一个伪随机可能完全不随机，可是是三个伪随机就十分接近随机了，每增加一个自由度，随机性增加的可不是一。"



## Http/2.0
HTTP 1.x 中，如果想并发多个请求，必须使用多个 TCP 链接（不能并发），且浏览器为了控制资源，还会对单个域名有 6-8个的TCP链接请求限制  
http 2.0 的特点：
- 多路复用：许同时通过单一的 HTTP/2 连接发起多重的请求-响应消息
   > 实现方式是二进制分帧：将 http/1.1 请求二进制编码，分割为帧：首部信息会被封装到 HEADER frame，而相应的 Request Body 则封装到 DATA frame 里面
- 首部压缩：压缩算法 hpack
- 服务端推送


## 参考

http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html

https://juejin.im/post/6844903608421449742
